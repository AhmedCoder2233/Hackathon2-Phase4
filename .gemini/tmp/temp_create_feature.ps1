# Better Auth Setup Specification ## File Structure ``` app/ 
 â”œâ”€â”€ api/auth/[...all]/route.ts 
 â”œâ”€â”€ lib/ 
 â”‚ â”œâ”€â”€ auth.ts 
 â”‚ â””â”€â”€ auth-client.ts 
 â”œâ”€â”€ page.tsx # Login/Signup page 
 â””â”€â”€ dashboard/page.tsx # Protected dashboard (simple welcome page) ``` ---
## 1. Database Setup ### Required Tables Better Auth automatically creates these tables: - `user` - Stores user data with unique ID - `session` - Manages active sessions - `account` - Handles auth providers ### User Table Structure (Auto-created) ```sql CREATE TABLE user ( id TEXT PRIMARY KEY, -- Unique user ID (auto-generated) email TEXT UNIQUE NOT NULL, emailVerified BOOLEAN, name TEXT, createdAt TIMESTAMP, updatedAt TIMESTAMP, image TEXT ); ``` Better Auth will automatically generate unique IDs using nanoid. ---
## 2. Auth Files Setup ### `app/api/auth/[...all]/route.ts` ```typescript import { auth } from "../../../lib/auth"; import { toNextJsHandler } from "better-auth/next-js"; export const { POST, GET } = toNextJsHandler(auth); ``` ### `app/lib/auth.ts` ```typescript import { betterAuth } from "better-auth"; import { Pool } from "pg"; const pool = new Pool({ connectionString: process.env.DATABASE_URL, }); pool.query("SELECT NOW()", (err, res) => { if (err) { console.error("âŒ Database connection failed:", err); } else { console.log("âœ… Database connected:", res.rows[0]); } }); export const auth = betterAuth({ database: pool, emailAndPassword: { enabled: true, minPasswordLength: 8, }, secret: process.env.BETTER_AUTH_SECRET!, baseURL: process.env.BETTER_AUTH_URL || "http://localhost:3000", logger: { level: "debug", }, // User ID is automatically generated as unique string }); ``` ### `app/lib/auth-client.ts` ```typescript "use client"; import { createAuthClient } from "better-auth/react"; export const authClient = createAuthClient({ baseURL: process.env.NEXT_PUBLIC_APP_URL || "http://localhost:3000", }); export const { signIn, signUp, signOut, useSession } = authClient; ``` ### `.env.local` ```env NEXT_PUBLIC_APP_URL=http://localhost:3000 BETTER_AUTH_SECRET=your-secret-key-minimum-32-characters-long BETTER_AUTH_URL=http://localhost:3000 DATABASE_URL=postgresql://username:password@localhost:5432/mydb ``` ---
## 3. Login/Signup Page (`app/page.tsx`) ### Requirements - Email + Password fields - Toggle between Login/Signup - Form validation - Error messages - Success redirect to `/dashboard` ### UI Design ``` â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ðŸ” Welcome Back â”‚ â”‚ â”‚ â”‚ Email â”‚ â”‚ [_____________________________] â”‚ â”‚ â”‚ â”‚ Password â”‚ â”‚ [_____________________________] â”‚ â”‚ â”‚ â”‚ [ Login / Sign Up ] â”‚ â”‚ â”‚ â”‚ Don't have account? Sign up here â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ``` ### Example Implementation ```typescript "use client"; import { useState } from "react"; import { signIn, signUp } from "./lib/auth-client"; import { useRouter } from "next/navigation"; export default function LoginPage() { const [isLogin, setIsLogin] = useState(true); const [email, setEmail] = useState(""); const [password, setPassword] = useState(""); const [name, setName] = useState(""); const [error, setError] = useState(""); const router = useRouter(); const handleSubmit = async (e: React.FormEvent) => { e.preventDefault(); setError(""); try { if (isLogin) { // Login await signIn.email({ email, password }); } else { // Sign up - User ID auto-generated by Better Auth await signUp.email({ email, password, name }); } router.push("/dashboard"); } catch (err: any) { setError(err.message || "Authentication failed"); } }; return ( <div class="min-h-screen flex items-center justify-center bg-gray-50"> <div class="bg-white p-8 rounded-lg shadow-md w-96"> <h1 class="text-2xl font-bold mb-6 text-center"> {isLogin ? "Login" : "Sign Up"} </h1> <form onSubmit={handleSubmit}> {!isLogin && ( <input type="text" placeholder="Name" value={name} onChange={(e) => setName(e.target.value)} required /> )} <input type="email" placeholder="Email" value={email} onChange={(e) => setEmail(e.target.value)} required /> <input type="password" placeholder="Password" value={password} onChange={(e) => setPassword(e.target.value)} required /> {error && <p class="text-red-500">{error}</p>} <button type="submit"> {isLogin ? "Login" : "Sign Up"} </button> </form> <button onClick={() => setIsLogin(!isLogin)}> {isLogin ? "Need an account? Sign up" : "Have an account? Login"} </button> </div> </div> ); } ``` ---
## 4. Dashboard Page (`app/dashboard/page.tsx`) ### Simple Protected Welcome Page ```typescript "use client"; import { useSession,signOut } from "../lib/auth-client"; import { useRouter } from "next/navigation"; import { useEffect } from "react"; export default function DashboardPage() { const { data: session, isPending } = useSession(); const router = useRouter(); useEffect(() => { if (!isPending && !session) { router.push("/"); } }, [session, isPending, router]); if (isPending) { return ( <div class="min-h-screen flex items-center justify-center"> <div class="text-xl">Loading...</div> </div> ); } if (!session?.user) return null; const handleLogout = async () => { await signOut(); router.push("/"); }; return ( <div class="min-h-screen bg-gray-50 p-8"> <div class="max-w-4xl mx-auto"> <div class="bg-white rounded-lg shadow-md p-8"> <div class="flex justify-between items-center mb-6"> <h1 class="text-3xl font-bold"> Welcome, {session.user.name || session.user.email}! ðŸŽ‰ </h1> <button onClick={handleLogout} class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600" > Logout </button> </div> <div class="bg-gray-100 p-6 rounded-lg"> <h2 class="text-xl font-semibold mb-4">Your Account Info:</h2> <p><strong>User ID:</strong> {session.user.id}</p> <p><strong>Email:</strong> {session.user.email}</p> <p><strong>Name:</strong> {session.user.name || "Not set"}</p> </div> </div> </div> </div> ); } ``` ---
## 5. User Flow ### Complete Authentication Flow ``` 1. User visits app â†’ Lands on `/` (Login page) 
 2. User clicks "Sign Up" 
 3. Fills: Name, Email, Password 
 4. Clicks "Sign Up" button 
 5. Better Auth: - Generates unique user ID automatically - Hashes password - Saves to database - Creates session 
 6. Redirect to `/dashboard` 
 7. Dashboard shows: - User ID (unique, auto-generated) - User name - User email 
 8. User clicks "Logout" 
 9. Redirects back to `/` ``` ---
## 6. Database Operations (Auto-handled by Better Auth) ### What Happens on Sign Up ```typescript // Better Auth automatically handles: 
 1. Generate unique user ID (using nanoid) 
 2. Hash password (using bcrypt) 
 3. Insert into user table: { id: "generated_unique_id_123", email: "user@example.com", name: "John Doe", createdAt: "2025-12-13T...", updatedAt: "2025-12-13T...", } 
 4. Create session 
 5. Return user data ``` ### User ID Format Better Auth uses **nanoid** for unique IDs: - Example: "7nZq8xK2mP4wRvLt" - Length: 16 characters - URL-safe - Collision-resistant ---
## 7. Success Checklist ### Installation - [ ] Install Better Auth: `npm install better-auth` - [ ] Install pg: `npm install pg` - [ ] Setup `.env.local` with database URL and secrets ### Auth Setup - [ ] Create `app/api/auth/[...all]/route.ts` - [ ] Create `app/lib/auth.ts` - [ ] Create `app/lib/auth-client.ts` - [ ] Test database connection ### Pages - [ ] Create login/signup page at `app/page.tsx` - [ ] Create dashboard at `app/dashboard/page.tsx` ### Testing - [ ] User can sign up with email/password - [ ] Unique user ID is generated and saved to DB - [ ] User can log in - [ ] Dashboard shows user ID, name, email - [ ] Session persists on page refresh - [ ] User can log out - [ ] Protected route redirects to login if not authenticated ---
## 8. Important Notes ### What This Does âœ… Complete authentication system âœ… Email/password login and signup âœ… Unique user ID auto-generated âœ… Secure password hashing âœ… Session management âœ… Protected routes âœ… Database persistence ### What Happens Automatically - User ID generation (nanoid) - Password hashing (bcrypt) - Session creation - Database table creation - Token management ### Security Features - Password hashing - Session tokens - CSRF protection - Secure cookies - SQL injection prevention (via prepared statements) ---
## 9. Environment Variables Required ```env # Database DATABASE_URL=postgresql://user:password@localhost:5432/mydb # Better Auth BETTER_AUTH_SECRET=your-32-character-or-longer-secret-key BETTER_AUTH_URL=http://localhost:3000 # Next.js Public NEXT_PUBLIC_APP_URL=http://localhost:3000 ``` **IMPORTANT**: Generate a secure secret: ```bash openssl rand -base64 32 ``` ---
## 10. Quick Start Commands ```bash # Install dependencies npm install better-auth pg # Run database migrations (Better Auth auto-creates tables) # Just run the app and tables will be created automatically # Start dev server npm run dev ``` ---
**Time Estimate**: 2-3 hours **Focus**: Authentication setup with auto-generated unique user IDs **Database**: PostgreSQL with auto-created tables **Next Step**: Add features after auth is working
"@ 
.specify/scripts/powershell/create-new-feature.ps1 -Json $jsonContent -Number 1 -ShortName "better-auth-setup"